# S3 Configuration
# Toggle between DevServices (testcontainers) and external services
# Set USE_DEVSERVICES=false to use external S3-compatible service (LocalStack or Tigris)
quarkus.s3.devservices.enabled=${USE_DEVSERVICES:true}
quarkus.s3.aws.region=${AWS_REGION:us-east-1}
quarkus.s3.aws.credentials.type=static
quarkus.s3.aws.credentials.static-provider.access-key-id=${AWS_ACCESS_KEY_ID:test}
quarkus.s3.aws.credentials.static-provider.secret-access-key=${AWS_SECRET_ACCESS_KEY:test}
quarkus.s3.sync-client.type=apache

# S3 Endpoint (only used when DevServices is disabled)
# LocalStack: http://localhost:4566
# Tigris: https://fly.storage.tigris.dev

%dev.quarkus.s3.endpoint-override=${S3_ENDPOINT_URL:http://localhost:4566}
%prod.quarkus.s3.endpoint-override=${S3_ENDPOINT_URL:}

# Tigris-specific configuration
# When using Tigris, set AWS_REGION=auto for automatic region routing
# Tigris uses path-style access for S3 API
quarkus.s3.path-style-access=${S3_PATH_STYLE_ACCESS:false}

# Bucket Configuration
bucket.name=${S3_BUCKET_NAME:whisper-uploads}
quarkus.s3.devservices.buckets=${bucket.name}

# NATS JetStream Configuration
quarkus.messaging.nats.devservices.enabled=true
quarkus.messaging.nats.devservices.port=32871
quarkus.messaging.nats.auto-configuration=true

#quarkus.messaging.nats.connection.servers=nats://localhost:32871

mp.messaging.outgoing.file-uploads.connector=quarkus-jetstream
mp.messaging.outgoing.file-uploads.stream=FILE_UPLOADS
mp.messaging.outgoing.file-uploads.subject=file.uploads



# Application Base Path
quarkus.http.root-path=/whisper
# Note: No quarkus.rest.path - use @Path annotations for full control

# Multipart/File Upload Configuration
quarkus.http.limits.max-body-size=110M
quarkus.resteasy-reactive.multipart.file-content-types=audio/mpeg,audio/mp3,application/octet-stream
quarkus.resteasy-reactive.multipart.input-part.default-content-type=application/octet-stream

# OpenAPI/Swagger Configuration
quarkus.smallrye-openapi.path=/swagger
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger-ui
mp.openapi.extensions.smallrye.info.title=Whisper MP3 Upload API
mp.openapi.extensions.smallrye.info.version=1.0.0
mp.openapi.extensions.smallrye.info.description=API for uploading MP3 files to S3 with passphrase authentication
mp.openapi.extensions.smallrye.info.contact.name=Cresterida
mp.openapi.extensions.smallrye.info.license.name=Apache 2.0

# Quinoa configuration
quarkus.quinoa.ui-dir=src/main/webui
quarkus.quinoa.package-manager=npm
quarkus.quinoa.dev-server.port=4200
quarkus.quinoa.package-manager-install=true
quarkus.quinoa.package-manager-install.node-version=22.12.0
quarkus.quinoa.package-manager-install.npm-version=10.9.0
# Enable SPA routing but ensure API routes go to Quarkus
quarkus.quinoa.enable-spa-routing=true
# Tell Quinoa to ignore these paths and let Quarkus handle them
# This ensures Swagger UI, OpenAPI, and management endpoints work correctly
quarkus.quinoa.ignored-path-prefixes=/api,/q,/swagger-ui,/swagger,/openapi
# IMPORTANT: Do NOT use direct-forwarding - it bypasses Quarkus routing
# quarkus.quinoa.dev-server.direct-forwarding=false
quarkus.quinoa.dev-server.check-timeout=60000

# Encryption Configuration
# Application passphrase (same as used in validatePassphrase endpoint)
app.passphrase=${APP_PASSPHRASE:your-secret-passphrase}
# Master key for envelope encryption (base64-encoded 256-bit key)
# IMPORTANT: Generate a new key for production using CryptoService.generateMasterKey()
# For development, using a fixed key (replace with secure key in production!)
encryption.master.key=${ENCRYPTION_MASTER_KEY:+hMMpH56z4xefxKZI1cp6PbIFeY1fRFbNiECMfkYy/U=}
# Enable verification of encrypted data from Angular (decrypt to verify integrity)
encryption.verify.enabled=${ENCRYPTION_VERIFY_ENABLED:true}

# Decryption Configuration
# Local download path for decrypted files (dev mode only)
decrypt.download.path=${DECRYPT_DOWNLOAD_PATH:./downloads}

# OpenTelemetry Configuration
# Disable OTLP exporter in dev/test to avoid connection warnings
%dev.quarkus.otel.traces.exporter=none
%test.quarkus.otel.traces.exporter=none
# Enable in production when OTLP collector is available
%prod.quarkus.otel.traces.exporter=otlp
%prod.quarkus.otel.exporter.otlp.endpoint=${OTLP_ENDPOINT:http://localhost:4317}

# Logging Configuration
# Application log level (can be overridden with LOG_LEVEL_APP environment variable)
# Levels: TRACE, DEBUG, INFO, WARN, ERROR, OFF
quarkus.log.category."me.cresterida".level=${LOG_LEVEL_APP:INFO}
